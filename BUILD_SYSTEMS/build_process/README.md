# Build Process

The process of converting the high level source code into
an executable **binary image**.

Five keys steps are involved:

- Pre-processing
- Compiling
- Assembling
- Linking
- Locating

```
 ┌--------------┐                    ┌--------------------┐                 ┌----------------┐
 | Source files |--- Preprocessor -->| Preprocessed files | --- Compiler -->| Assembly Files |
 |   (.c/.h)    |                    |        (.i)        |                 |      (.s)      |
 └--------------┘                    └--------------------┘                 └----------------┘
                                                                                    |
       ┌------------------------------ Assembler -----------------------------------┘
       ↓
 ┌--------------┐               ┌-------------------┐               ┌------------┐
 | Object files |               | Relocatable files |               | Executable |
 |     (.o)     |--- Linker --> |                   |--- Locator -->|            |
 └--------------┘               └-------------------┘               └------------┘

```

### Prepocessor

- The pre-processor strips out comments from the input files.
- The pre-processor also evaluates preprocessor directives by
replacing lines that start with #

### Compiler

- The compiler converts the c code to the architecture specific
assembly code.

### Assembler

- The assembler converts the assembly code to object code.

### Linker

- The different object files that were generated by the assembler
gets converted into one relocatable file by the linker

### Locator

- Input files are relocatable file and linker script, then output
file are an executable file (.elf)
- The locator converts the relocatable program to an executable binary
- The linker script provides the locator with the required information
about the actual memory layout and then the locator performs the
conversion to produce a single executable binary file

Examples file formats: Executable and Linkable Format (ELF), Common Object
File Format (COFF), Intel Hex Recordm Motorola S Record (SREC), ARM Image
Format (AIF), Binary

## GNU Bin Tools

- **arm-none-eabi-gcc** - Compile, assemble and link

    - Example: arm-none-eabi-gcc main.c -o main.o

| Option | Purpose
|---|---|
| -C        | Compile and Assemble, do not Link |
| -o [FILE] | Compile, Assemble and Link to output FILE |
| -g        | Generate Debugging Information in Executable |
| -Wall     | Enable All Warning Messages |
| -Werror   | Treat all Warnings as Errors |
| -I[DIR]   | Include this DIR to look for header files |
| --std = STANDARD | Specify which standard version to use |
| -V        | Verbose output from GCC |
| -mcpu = [NAME] | Specifies the target ARM Processor and architecture |
| -march = [NAME] | Specifies the target ARM Architecture |
| -mthumb | To generate code in Thumb Instruction Set Architecture (ISA) |
| -marm | To generate code in ARM Instruction Set Architecture (ISA) |

e.g: arm-none-eabi-gcc -c -mcpu=cortex-m4 -mthumb main.c -o main.o

- **arm-none-eabi-nm** - List the symbols from object files

- **arm-none-eabi-size** - List the section sizes of object and executable files

- **arm-none-eabi-objdump** - Dumps information about an object file. Used to
analyze an object file.

- **arm-none-eabi-readelf** - Read informations from elf files

- **arm-none-eabi-objcopy** - used to convert object files form one format to another.
Also used to make a copy of an object file.

- **arm-none-eabi-gdb** - Debugging programs on ARM Cortex-M microcontrollers, it allows
to inspect and control the execution of code running. Also used to flash code.

## Exploring GNU Bin Tools

GNU GCC Manual is the best reference.

- **Compile:**

    `arm-none-eabe-gcc -c main.c -o main.o`

    Compile, assemble and dont link!

- **Compile adding options:**

    `arm-none-eabe-gcc -c -mcpu=cortex-m4 -mthumb main.c -o main.o`

    Compile, assemble and dont link with flags to specific arm.

- **Stopping after compilation:**

    `arm-none-eabe-gcc -S -mcpu=cortex-m4 -mthumb main.c -o main.s`

- **Stopping after preprocessing:**

    `arm-none-eabe-gcc -E -mcpu=cortex-m4 -mthumb main.c -o main.i`

Obs: is just a convention to use the same name to output file, would be fine to be
something like:

`arm-none-eabe-gcc -c -mcpu=cortex-m4 -mthumb main.c -o other_name.o`